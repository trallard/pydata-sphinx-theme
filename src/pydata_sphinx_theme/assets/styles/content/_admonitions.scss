/**
 * Admonitions and blocks of styled content.
 * Admonitions CSS originally inspired by https://squidfunk.github.io/mkdocs-material/getting-started/
 */
// Configuration Variables
$admonition-border-radius: 0.25rem;
$admonition-border-width: 0.2rem;
$admonition-left-border-width: 0.2rem;
$admonition-spacing: 1rem;
$admonition-icon-size: 1rem;
$admonition-icon-margin: 0.5rem;
$admonition-content-indent: 1.4rem;

// Admonition type definitions - centralized configuration
$admonition-types: (
  "default": (
    "border": "var(--pst-color-info)",
    "bg": "var(--pst-color-info-bg)",
    "color": "var(--pst-color-info)",
    "icon": "var(--pst-icon-admonition-default)",
  ),
  "attention": (
    "border": "var(--pst-color-attention)",
    "bg": "var(--pst-color-attention-bg)",
    "color": "var(--pst-color-attention)",
    "icon": "var(--pst-icon-admonition-attention)",
  ),
  "caution": (
    "border": "var(--pst-color-warning)",
    "bg": "var(--pst-color-warning-bg)",
    "color": "var(--pst-color-warning)",
    "icon": "var(--pst-icon-admonition-caution)",
  ),
  "warning": (
    "border": "var(--pst-color-warning)",
    "bg": "var(--pst-color-warning-bg)",
    "color": "var(--pst-color-warning)",
    "icon": "var(--pst-icon-admonition-warning)",
  ),
  "danger": (
    "border": "var(--pst-color-danger)",
    "bg": "var(--pst-color-danger-bg)",
    "color": "var(--pst-color-danger)",
    "icon": "var(--pst-icon-admonition-danger)",
  ),
  "error": (
    "border": "var(--pst-color-danger)",
    "bg": "var(--pst-color-danger-bg)",
    "color": "var(--pst-color-danger)",
    "icon": "var(--pst-icon-admonition-error)",
  ),
  "hint": (
    "border": "var(--pst-color-success)",
    "bg": "var(--pst-color-success-bg)",
    "color": "var(--pst-color-success)",
    "icon": "var(--pst-icon-admonition-hint)",
  ),
  "tip": (
    "border": "var(--pst-color-success)",
    "bg": "var(--pst-color-success-bg)",
    "color": "var(--pst-color-success)",
    "icon": "var(--pst-icon-admonition-tip)",
  ),
  "important": (
    "border": "var(--pst-color-attention)",
    "bg": "var(--pst-color-attention-bg)",
    "color": "var(--pst-color-attention)",
    "icon": "var(--pst-icon-admonition-important)",
  ),
  "note": (
    "border": "var(--pst-color-info)",
    "bg": "var(--pst-color-info-bg)",
    "color": "var(--pst-color-info)",
    "icon": "var(--pst-icon-admonition-note)",
  ),
  "seealso": (
    "border": "var(--pst-color-success)",
    "bg": "var(--pst-color-success-bg)",
    "color": "var(--pst-color-success)",
    "icon": "var(--pst-icon-admonition-seealso)",
  ),
  "admonition-todo": (
    "border": "var(--pst-color-secondary)",
    "bg": "var(--pst-color-secondary-bg)",
    "color": "var(--pst-color-secondary)",
    "icon": "var(--pst-icon-admonition-todo)",
  ),
);

// Mixin for applying admonition type styles
@mixin admonition-type($config) {
  border-color: #{map-get($config, "color")};

  > .admonition-title {
    background-color: #{map-get($config, "bg")};

    &::before {
      color: #{map-get($config, "color")};
      content: #{map-get($config, "icon")};
    }
  }

  .svg-inline--fa {
    color: #{map-get($config, "color")};
    position: absolute;
    top: 0.4rem;
    left: 0;
    width: $admonition-icon-size;
    height: $admonition-icon-size;
    padding: 0.4rem 0.6rem 0.4rem 0.6rem;
  }
}

// Base admonition styles
div.admonition,
.admonition {
  // Layout and spacing
  margin: 1.5625em auto;
  padding: 0 0.6rem 0.8rem;
  overflow: hidden;

  // Print and display
  page-break-inside: avoid;
  break-inside: avoid;

  // Visual styling
  border-left: $admonition-border-width solid;
  border-radius: $admonition-border-radius;
  background-color: var(--pst-color-on-background);

  // Apply default styling
  @include admonition-type(map-get($admonition-types, "default"));
  @include box-shadow;

  // Content spacing rules
  *:last-child {
    margin-bottom: 0;
  }

  // Indent content after title
  p.admonition-title ~ * {
    margin-left: $admonition-content-indent;
    margin-right: $admonition-content-indent;
  }

  // List styling
  > ol,
  > ul {
    margin-left: 1em;
  }

  // Title styling
  > .admonition-title {
    // Calculate icon space
    $icon-space: calc(
      #{$admonition-icon-size} + #{2 * $admonition-icon-margin}
    );

    // Layout
    margin: 0 -0.6rem;
    padding: 0.4rem 0.6rem 0.4rem $icon-space;
    position: relative;
    z-index: 1;

    // Typography
    font-weight: var(--pst-admonition-font-weight-heading);

    // Reset the icon styling
    &::before {
      display: none;
      font: var(--fa-font-solid);
    }

    // Spacing for next element
    + * {
      margin-top: 0.4em;
    }
  }

  // Generate all admonition type styles
  @each $type, $config in $admonition-types {
    @if $type != "default" {
      &.#{$type} {
        @include admonition-type($config);
      }
    }
  }
}
/**************************************************************
 * Similar content blocks that are not technically admonitions.
 */

/**
 * Topics and the {contents} directive
 */
// Docutils <= 0.17
div.topic,
div.topic.contents,
// Docutils >= 0.18
nav.contents,
aside.topic {
  display: flex;
  flex-direction: column;
  background-color: var(--pst-color-surface);
  border-color: var(--pst-color-border);
  border-radius: $admonition-border-radius;
  padding: 1rem 1.25rem;

  @include box-shadow;

  .topic-title {
    margin: 0 0 0.5rem;
  }

  // Over-ride text color to ensure enough contrast
  p {
    color: var(--pst-color-on-surface) !important;
  }

  a {
    color: var(--pst-color-link-higher-contrast);
  }

  // Over-ride large default padding
  ul.simple {
    padding-left: 1rem;

    ul {
      // So that sub-lists will have a bit less padding
      padding-left: 2em;
    }
  }
}

/**
 * Sidebar directive
 */
aside.sidebar {
  border: 1px solid var(--pst-color-border);
  background-color: var(--pst-color-surface);
  border-radius: $admonition-border-radius;

  // to match the admonition-styled sidebars:
  margin-left: 0.5rem;
  padding: 0;

  > *:last-child {
    padding-bottom: 1rem;
  }

  p.sidebar-title {
    position: relative;
    margin-bottom: 0;
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--pst-color-border);
    font-family: var(--pst-font-family-heading);
    font-weight: var(--pst-admonition-font-weight-heading);
  }

  // Add margin to the first non-`.sidebar-title` item
  > *:not(.sidebar-title):first-child,
  > p.sidebar-title + * {
    margin-top: 1rem;
  }

  > * {
    padding-left: 1rem;
    padding-right: 1rem;
  }
}

/**
 * Rubrics look kind of like section headers
 */
p.rubric {
  display: flex;
  flex-direction: column;
}

/**
 * Seealso is kind of like a vertically-collapsed admonition
 */
.seealso dd {
  margin-top: 0;
  margin-bottom: 0;
}
