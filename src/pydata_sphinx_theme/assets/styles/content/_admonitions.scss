/**
 * Admonitions and blocks of styled content.
 * Admonitions CSS originally inspired by https://squidfunk.github.io/mkdocs-material/getting-started/
 */

@use "sass:map";

// Configuration Variables
$admonition-border-radius: 0.25rem;
$admonition-left-border-width: 0.2rem;
$admonition-icon-size: 1rem;
$admonition-content-indent: 1.4rem;

/**
* Admonition types definitions
*/
// "color" is used for the icon and the admonition left border
$admonition-types: (
  "default": (
    "bg-color": "var(--pst-color-info-bg)",
    "color": "var(--pst-color-info)",
    "icon": "var(--pst-icon-admonition-default)",
  ),
  "attention": (
    "bg-color": "var(--pst-color-attention-bg)",
    "color": "var(--pst-color-attention)",
    "icon": "var(--pst-icon-admonition-attention)",
  ),
  "caution": (
    "bg-color": "var(--pst-color-warning-bg)",
    "color": "var(--pst-color-warning)",
    "icon": "var(--pst-icon-admonition-caution)",
  ),
  "warning": (
    "bg-color": "var(--pst-color-warning-bg)",
    "color": "var(--pst-color-warning)",
    "icon": "var(--pst-icon-admonition-warning)",
  ),
  "danger": (
    "bg-color": "var(--pst-color-danger-bg)",
    "color": "var(--pst-color-danger)",
    "icon": "var(--pst-icon-admonition-danger)",
  ),
  "error": (
    "bg-color": "var(--pst-color-danger-bg)",
    "color": "var(--pst-color-danger)",
    "icon": "var(--pst-icon-admonition-error)",
  ),
  "hint": (
    "bg-color": "var(--pst-color-success-bg)",
    "color": "var(--pst-color-success)",
    "icon": "var(--pst-icon-admonition-hint)",
  ),
  "tip": (
    "bg-color": "var(--pst-color-success-bg)",
    "color": "var(--pst-color-success)",
    "icon": "var(--pst-icon-admonition-tip)",
  ),
  "important": (
    "bg-color": "var(--pst-color-attention-bg)",
    "color": "var(--pst-color-attention)",
    "icon": "var(--pst-icon-admonition-important)",
  ),
  "note": (
    "bg-color": "var(--pst-color-info-bg)",
    "color": "var(--pst-color-info)",
    "icon": "var(--pst-icon-admonition-note)",
  ),
  "seealso": (
    "bg-color": "var(--pst-color-success-bg)",
    "color": "var(--pst-color-success)",
    "icon": "var(--pst-icon-admonition-seealso)",
  ),
  "admonition-todo": (
    "bg-color": "var(--pst-color-secondary-bg)",
    "color": "var(--pst-color-secondary)",
    "icon": "var(--pst-icon-admonition-todo)",
  ),
);

/**
* Mixin to apply type-specific styles to admonitions
*/
// @param {Map} $admonition-properties - Map of properties for the admonition type
// should match a type in $admonition-types
@mixin style-admonition($admonition-properties) {
  border-color: #{map.get($admonition-properties, "color")};

  > .admonition-title {
    background-color: #{map.get($admonition-properties, "bg-color")};

    &::after {
      color: #{map.get($admonition-properties, "color")};
      content: #{map.get($admonition-properties, "icon")};
    }
  }

  // Style svg FontAwesome icon
  .svg-inline--fa {
    position: absolute;
    top: 0.4rem;
    left: 0;
    width: $admonition-icon-size;
    height: $admonition-icon-size;
    padding: 0.4rem 0.6rem;
    color: #{map.get($admonition-properties, "color")};
  }
}

// Base admoniton styles
div.admonition,
.admonition {
  margin: 1.5625em auto;
  padding: 0 0.6rem 0.8rem;
  overflow: hidden;

  // Print and display

  /* break-inside has replaced page-break-inside and is widely usable since 2019 */
  page-break-inside: avoid;
  break-inside: avoid;
  border-left: $admonition-left-border-width solid;
  border-radius: $admonition-border-radius;
  background-color: var(--pst-color-on-background);

  @include box-shadow;

  // Apply default styling
  @include style-admonition(map.get($admonition-types, "default"));

  // Last item should have no spacing since we'll control that w/ padding
  *:last-child {
    margin-bottom: 0;
  }

  // Items after the title should be indented
  p.admonition-title ~ * {
    margin-left: 1.4rem;
    margin-right: 1.4rem;
  }

  // Lists need to have left margin so they don't spill into it
  > ol,
  > ul {
    margin-left: 1em;
  }

  // Defaults for all admonitions
  > .admonition-title {
    $padding-top: 0.4rem;
    $icon-width: 1rem;
    $icon-margin-x: 0.5rem;

    // Calculate icon space
    $icon-space: calc(#{$icon-width} + #{2 * $icon-margin-x});

    // Layout
    margin: 0 -0.6rem;
    padding: 0.4rem 0.6rem $padding-top $icon-space;
    position: relative;
    z-index: 1;
    font-weight: var(--pst-admonition-font-weight-heading);

    &::after {
      // Reset the icon styling: this removes the unicode character
      display: none;
      font: var(--fa-font-solid);
    }

    // Next element after title needs some extra upper-space
    + * {
      margin-top: 0.4em;
    }
  }

  // Generate all admonition types
  @each $admonition-type, $admonition-properties in $admonition-types {
    @if $admonition-type != "default" {
      &.#{$admonition-type} {
        @include style-admonition(
          map.get($admonition-types, #{$admonition-type})
        );
      }
    }
  }

  /**
   * Special-case for a `sidebar` class that makes the admonition float to
   * the right like the {sidebar} directive.
   */
  &.sidebar {
    max-width: 40%;
    float: right;
    clear: both;
    margin-left: 0.5rem;
    margin-top: 0;

    // Undo the .sidebar directive border
    border-width: 0 0 0 $admonition-left-border-width;

    // No inner margin since we have less horizontal space w/ the sidebar
    p.admonition-title ~ * {
      margin-left: 0;
      margin-right: 0;
    }
  }
}

/**************************************************************
 * Similar content blocks that are not technically admonitions.
 */

/**
 * Topics and the {contents} directive
 */
// Docutils <= 0.17
div.topic,
div.topic.contents,
// Docutils >= 0.18
nav.contents,
aside.topic {
  display: flex;
  flex-direction: column;
  background-color: var(--pst-color-surface);
  border-color: var(--pst-color-border);
  border-radius: $admonition-border-radius;
  padding: 1rem 1.25rem;

  @include box-shadow;

  .topic-title {
    margin: 0 0 0.5rem;
  }

  // Over-ride text color to ensure enough contrast
  p {
    color: var(--pst-color-on-surface) !important;
  }

  a {
    color: var(--pst-color-link-higher-contrast);
  }

  // Over-ride large default padding
  ul.simple {
    padding-left: 1rem;

    ul {
      // So that sub-lists will have a bit less padding
      padding-left: 2em;
    }
  }
}

/**
 * Sidebar directive
 */
aside.sidebar {
  border: 1px solid var(--pst-color-border);
  background-color: var(--pst-color-surface);
  border-radius: $admonition-border-radius;

  // to match the admonition-styled sidebars:
  margin-left: 0.5rem;
  padding: 0;

  > *:last-child {
    padding-bottom: 1rem;
  }

  p.sidebar-title {
    position: relative;
    margin-bottom: 0;
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--pst-color-border);
    font-family: var(--pst-font-family-heading);
    font-weight: var(--pst-admonition-font-weight-heading);
  }

  // Add margin to the first non-`.sidebar-title` item
  > *:not(.sidebar-title):first-child,
  > p.sidebar-title + * {
    margin-top: 1rem;
  }

  > * {
    padding-left: 1rem;
    padding-right: 1rem;
  }
}

/**
 * Rubrics look kind of like section headers
 */
p.rubric {
  display: flex;
  flex-direction: column;
}

/**
 * Seealso is kind of like a vertically-collapsed admonition
 */
.seealso dd {
  margin-top: 0;
  margin-bottom: 0;
}
